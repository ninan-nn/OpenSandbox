<!DOCTYPE html>
<!--
 Copyright 2025 Alibaba Group Holding Ltd.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<html>
<head>
  <title>OpenSandbox Lifecycle API Documentation</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:300,400,700" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Roboto', sans-serif;
    }
  </style>
</head>
<body>
  <div id="redoc-container"></div>

  <!-- Load js-yaml first for YAML parsing -->
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4/dist/js-yaml.min.js"></script>

  <!-- Load ReDoc (stable version) -->
  <script src="https://cdn.jsdelivr.net/npm/redoc@latest/bundles/redoc.standalone.js"></script>

  <!-- Load generated inline spec -->
  <script src="../../docs/public/api/spec-inline.js"></script>

  <!-- Initialize ReDoc after all libraries are loaded -->
  <script>
    console.log('üìÑ OpenSandbox API Documentation - Initializing');

    window.addEventListener('load', function() {
      console.log('üîç Page fully loaded, checking dependencies...');
      console.log('   - Redoc available?', typeof Redoc !== 'undefined');
      console.log('   - jsyaml available?', typeof jsyaml !== 'undefined');
      console.log('   - OPENAPI_SPEC_YAML available?', typeof OPENAPI_SPEC_YAML !== 'undefined');

      // Check if Redoc is available
      if (typeof Redoc === 'undefined') {
        console.error('‚ùå Redoc library failed to load');
        document.getElementById('redoc-container').innerHTML =
          '<div style="padding: 20px; color: red;"><strong>‚ùå Error:</strong> Redoc library failed to load.</div>';
        return;
      }

      // Check if js-yaml is available
      if (typeof jsyaml === 'undefined') {
        console.error('‚ùå js-yaml library failed to load');
        document.getElementById('redoc-container').innerHTML =
          '<div style="padding: 20px; color: red;"><strong>‚ùå Error:</strong> js-yaml library failed to load.</div>';
        return;
      }

      // Check if spec is available
      if (typeof OPENAPI_SPEC_YAML === 'undefined') {
        console.error('‚ùå API specification not loaded');
        document.getElementById('redoc-container').innerHTML =
          '<div style="padding: 20px; color: red;"><strong>‚ùå Error:</strong> API specification not loaded. Make sure spec-inline.js exists.</div>';
        return;
      }

      try {
        console.log('üìù Parsing OpenAPI YAML spec...');
        const spec = jsyaml.load(OPENAPI_SPEC_YAML);
        console.log('‚úÖ YAML parsed successfully');

        // Log spec info
        const pathCount = Object.keys(spec.paths || {}).length;
        console.log(`üìä Spec contains ${pathCount} paths`);

        // Check for endpoints/{port}
        if (spec.paths && spec.paths['/sandboxes/{sandboxId}/endpoints/{port}']) {
          console.log('‚ú® Found /sandboxes/{sandboxId}/endpoints/{port} route');
        } else {
          console.warn('‚ö†Ô∏è  /sandboxes/{sandboxId}/endpoints/{port} route not found in spec');
        }

        console.log('üé® Initializing Redoc...');
        Redoc.init(spec, {
          scrollYOffset: 50,
          theme: {
            colors: {
              primary: {
                main: '#1f2937'
              }
            }
          }
        }, document.getElementById('redoc-container'));

        console.log('‚úÖ Redoc initialized successfully!');
      } catch (error) {
        console.error('‚ùå Error during initialization:', error);
        document.getElementById('redoc-container').innerHTML =
          '<div style="padding: 20px; color: red;">' +
          '<strong>‚ùå Error:</strong> Failed to parse OpenAPI specification.<br/>' +
          '<code>' + error.message + '</code></div>';
      }
    });
  </script>
</body>
</html>
